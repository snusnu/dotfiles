#/bin/bash

_ssh_config_hosts() {
  local cur opts

  COMPREPLY=()

  cur="${COMP_WORDS[COMP_CWORD]}"

  opts=$(\
    grep '^Host' "$(ls -d -1 ~/.ssh/config.d/* | xargs)" \
    | grep -v '[?*]' \
    | cut -d ' ' -f 2- \
  )

  COMPREPLY=( "$(compgen -W "$opts" -- "$cur")" )

  return 0
}

complete -F _ssh_config_hosts ssh
